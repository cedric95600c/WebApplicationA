<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movies</title>
    <meta name="viewport" content="width=device-width">
   
</head>

<body>
    <div id="all" style="text-align: center;">  
    </div>
    <div id="output" style="text-align: center;">  
    </div>
    <div id = "champ0" style="text-align: center;">
     <label for="bar"></label>
     <input type="text" placeholder="Acteur/Directeur" id="insert0" />
     <input type="submit" id="bar" onclick="inputActor()" />
    </div>
     

</body>

<script>
let APIKEY = "7e7d5e799923b761e3615e5dc280af26"
let baseURL = 'https://api.themoviedb.org/3/';
let configData = null;
let baseImageURL = null;

let current_movie = "jaws";
let current_actor = "";

let list_movie = ["pulp fiction"];
let curr_id = 0;
let curr_actorid=0;
let compteur = 0

let getConfig = function () {
    let compteur = 0
    let url = ''.concat(baseURL, 'search/movie?api_key=', APIKEY, '&query=pulp fiction');
    let container = document.getElementById('output')
    
    //document.getElementById('output').innerHTML = JSON.stringify(data, null, 4);
    fetch(url)
    .then(result=>result.json())
    .then((data)=>
    {   curr_id = data.results[0].id;
        const html = `
        <p> Movie : ${data.results[0].original_title} </p> 
        <img src="http://image.tmdb.org/t/p/w185${data.results[0].poster_path}"> 
        <p> Release : ${data.results[0].release_date} </p>`
        
        let div = document.getElementById('output');
        div.innerHTML += html;
        //document.getElementById('output').innerHTML = JSON.stringify(data.results[0], null, 4);
    })
    
}

let inputMovie = function(){
    
   
   
    keyword = document.getElementById(`insert${compteur}`).value.toLowerCase();
    
    document.getElementById(`champ${compteur}`).style.visibility = "hidden"
    compteur +=1;
    //console.log(keyword)
    console.log(list_movie)
    let url = ''.concat(baseURL, 'person/',curr_actorid,'/movie_credits?api_key=', APIKEY);
    fetch(url)
    .then(result=>result.json()).then((data)=>
    {
        let list_actor_movie = []
        console.log(data);
        for (i=0;i<data.cast.length;i++)
        {
            list_actor_movie.push(data.cast[i].original_title.toLowerCase())
        }
        for (i=0;i<data.crew.length;i++)
        {   
            list_actor_movie.push(data.crew[i].original_title.toLowerCase())
        }
        console.log(list_actor_movie)
        keywordin = list_actor_movie.includes(keyword.toLowerCase())
       
        if(!keywordin)
        {
            console.log("ok")
            document.getElementById('output').innerHTML += `<h1 style="color:red">${keyword} is a BAD ANSWER</h1>`
        }
        else
        {   if (list_movie.includes(keyword))
            {
                document.getElementById('output').innerHTML += `<h1 style="color:red">${keyword} is ALREADY SAY</h1>`
            }
            else{
            list_movie.push(keyword);
            let url = ''.concat(baseURL, 'search/movie?api_key=', APIKEY, '&query=',keyword);
            let container = document.getElementById('output')
            fetch(url)
            .then(result=>result.json())
            .then((data)=>
            {   curr_id = data.results[0].id;
                const html = `
                <p> Movie : ${data.results[0].original_title} </p> 
                <img src="http://image.tmdb.org/t/p/w185${data.results[0].poster_path}"> 
                <p> Release  : ${data.results[0].release_date} </p>
                <div id = "champ${compteur}" style="text-align: center;">
                <label for="bar"></label>
                <input type="text" placeholder="Acteur/Directeur" id="insert${compteur}" />
                <input type="submit" id="bar" onclick="inputActor()" />
                </div> `
                let old = document.getElementById('all') 
                let div = document.getElementById('output');
                old.innerHTML += div.innerHTML;
                div.innerHTML = html;
                })
            }
        }
    })
    
}
let inputActor = function () {
    
    keyword = document.getElementById(`insert${compteur}`).value;
    document.getElementById(`champ${compteur}`).style.visibility = "hidden"
    compteur +=1;
    console.log(keyword)
    list_actor = []
    let url = ''.concat(baseURL, 'movie/',curr_id,'/credits?api_key=', APIKEY);
    fetch(url)
    .then(result=>result.json()).then((data)=>
    {
        console.log(data.crew[1].known_for_department);
        for (i=0;i<data.cast.length;i++)
        {
            list_actor.push(data.cast[i].original_name.toLowerCase())
        }
        for (i=0;i<data.crew.length;i++)
        {   if (data.crew[i].known_for_department == "Directing")
            {list_actor.push(data.crew[i].original_name.toLowerCase())}
        }
        console.log(list_actor)
        keywordin = list_actor.includes(keyword.toLowerCase())
        
        if (!keywordin){
            
            
            document.getElementById('output').innerHTML += `<h1 style="color:red">${keyword} is a BAD ANSWER</h1>`
        }
        else
        {
            current_actor = keyword;
            
           
            let container = document.getElementById('output')
            let url = ''.concat(baseURL,'search/person?api_key=',APIKEY,'&query=',current_actor)
            fetch(url)
            .then(result=>result.json()).then((data)=>
            {
                console.log(data.results[0])
                curr_actorid = data.results[0].id;
               const html = `
                <p> Person  : ${data.results[0].name} </p> 
                <img src="http://image.tmdb.org/t/p/w185${data.results[0].profile_path}">
                <div id = "champ${compteur}" style="text-align: center;">
                <label for="bar"></label>
                <input type="text" placeholder="Film" id="insert${compteur}" />
                <input type="submit" id="bar" onclick="inputMovie()" />
                </div> `
                
                let div = document.getElementById('output');
                div.innerHTML += html;
            })
        }

    })
    
    
}

document.addEventListener('DOMContentLoaded', getConfig);



</script>
</html>






    
  